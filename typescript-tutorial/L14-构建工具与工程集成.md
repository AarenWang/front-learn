# L14 - æ„å»ºå·¥å…·ä¸å·¥ç¨‹é›†æˆ

## æœ¬è¯¾æ—¶ç›®æ ‡
- æŒæ¡ TypeScript ä¸ ESLint çš„é›†æˆé…ç½®
- å­¦ä¼šä½¿ç”¨ç°ä»£æ„å»ºå·¥å…·ï¼ˆtsupã€Viteã€Rollupï¼‰
- ç†è§£è·¯å¾„åˆ«åå’Œæ¨¡å—è§£æé…ç½®
- å®ç°å¤šè¾“å‡ºæ ¼å¼ï¼ˆESM/CJSï¼‰çš„æ„å»º
- æ„å»ºå®Œæ•´çš„å·¥ç¨‹åŒ– TypeScript åŒ…

## 1. ESLint + TypeScript é›†æˆ

### 1.1 ESLint é…ç½®

```json
// package.json
{
  "name": "ts-engineering-demo",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "tsup",
    "build:types": "tsc --declaration --emitDeclarationOnly --outDir dist/types",
    "lint": "eslint src --ext .ts,.tsx",
    "lint:fix": "eslint src --ext .ts,.tsx --fix",
    "typecheck": "tsc --noEmit",
    "test": "jest",
    "test:watch": "jest --watch",
    "prepublishOnly": "npm run build && npm run build:types"
  },
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.13.1",
    "@typescript-eslint/parser": "^6.13.1",
    "@typescript-eslint/utils": "^6.13.1",
    "eslint": "^8.54.0",
    "eslint-config-prettier": "^9.0.0",
    "eslint-plugin-import": "^2.29.0",
    "eslint-plugin-prettier": "^5.0.1",
    "prettier": "^3.1.0",
    "typescript": "^5.3.2",
    "tsup": "^7.2.0",
    "vite": "^5.0.0",
    "jest": "^29.7.0",
    "@types/jest": "^29.5.8",
    "ts-jest": "^29.1.1"
  }
}
```

```json
// .eslintrc.json
{
  "root": true,
  "env": {
    "browser": true,
    "es2022": true,
    "node": true
  },
  "extends": [
    "eslint:recommended",
    "@typescript-eslint/recommended",
    "@typescript-eslint/recommended-requiring-type-checking",
    "plugin:import/recommended",
    "plugin:import/typescript",
    "prettier"
  ],
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "ecmaVersion": "latest",
    "sourceType": "module",
    "project": "./tsconfig.json"
  },
  "plugins": [
    "@typescript-eslint",
    "import",
    "prettier"
  ],
  "settings": {
    "import/resolver": {
      "typescript": {
        "alwaysTryTypes": true,
        "project": "./tsconfig.json"
      }
    }
  },
  "rules": {
    "prettier/prettier": "error",
    "import/order": [
      "error",
      {
        "groups": [
          "builtin",
          "external",
          "internal",
          "parent",
          "sibling",
          "index",
          "object",
          "type"
        ],
        "newlines-between": "always",
        "alphabetize": {
          "order": "asc",
          "caseInsensitive": true
        },
        "distinctGroup": false
      }
    ],
    "@typescript-eslint/no-unused-vars": [
      "error",
      {
        "argsIgnorePattern": "^_",
        "varsIgnorePattern": "^_",
        "caughtErrorsIgnorePattern": "^_"
      }
    ],
    "@typescript-eslint/explicit-function-return-type": [
      "warn",
      {
        "allowExpressions": true,
        "allowTypedFunctionExpressions": true,
        "allowHigherOrderFunctions": true,
        "allowDirectConstAssertionInArrowFunctions": true,
        "allowConciseArrowFunctionExpressionsStartingWithVoid": false
      }
    ],
    "@typescript-eslint/no-explicit-any": "warn",
    "@typescript-eslint/no-non-null-assertion": "warn",
    "@typescript-eslint/prefer-nullish-coalescing": "error",
    "@typescript-eslint/prefer-optional-chain": "error",
    "@typescript-eslint/no-floating-promises": "error",
    "@typescript-eslint/await-thenable": "error",
    "@typescript-eslint/no-misused-promises": "error",
    "no-console": "warn",
    "prefer-const": "error",
    "no-var": "error"
  },
  "overrides": [
    {
      "files": ["*.test.ts", "*.spec.ts"],
      "env": {
        "jest": true
      },
      "rules": {
        "@typescript-eslint/no-explicit-any": "off",
        "@typescript-eslint/no-non-null-assertion": "off"
      }
    }
  ]
}
```

### 1.2 Prettier é…ç½®

```json
// .prettierrc
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false,
  "bracketSpacing": true,
  "arrowParens": "avoid",
  "endOfLine": "lf"
}
```

```json
// .prettierignore
node_modules
dist
coverage
*.lock
package-lock.json
```

## 2. ç°ä»£æ„å»ºå·¥å…·é…ç½®

### 2.1 tsup é…ç½®

```typescript
// tsup.config.ts
import { defineConfig } from 'tsup';

export default defineConfig({
  entry: {
    index: 'src/index.ts',
    cli: 'src/cli/index.ts'
  },
  format: ['cjs', 'esm', 'iife'],
  dts: true,
  clean: true,
  sourcemap: true,
  minify: false,
  target: 'es2020',
  outDir: 'dist',
  banner: {
    js: '"use strict";'
  },
  external: [
    // Node.js å†…ç½®æ¨¡å—
    /^node:/,
    // å¼€å‘ä¾èµ–
    'typescript',
    'eslint',
    'prettier'
  ],
  treeshake: true,
  splitting: false,
  onSuccess: async () => {
    console.log('âœ… Build completed successfully!');
  }
});
```

```typescript
// tsup.config.prod.ts
import { defineConfig } from 'tsup';

export default defineConfig({
  entry: ['src/index.ts'],
  format: ['cjs', 'esm'],
  dts: true,
  clean: true,
  sourcemap: false,
  minify: true,
  target: ['es2018', 'node14'],
  outDir: 'dist',
  // ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–
  treeshake: {
    preset: 'recommended'
  },
  // å¤–éƒ¨ä¾èµ–
  external: [
    /^node:/,
    'react',
    'react-dom',
    'vue',
    'angular'
  ]
});
```

### 2.2 Vite é…ç½®

```typescript
// vite.config.ts
import { defineConfig } from 'vite';
import { resolve } from 'path';
import dts from 'vite-plugin-dts';

export default defineConfig({
  plugins: [
    dts({
      include: ['src/**/*'],
      exclude: ['src/**/*.test.ts', 'src/**/*.spec.ts'],
      outDir: 'dist/types',
      rollupTypes: true
    })
  ],
  build: {
    lib: {
      entry: {
        index: resolve(__dirname, 'src/index.ts'),
        utils: resolve(__dirname, 'src/utils/index.ts')
      },
      name: 'TsEngineeringDemo',
      formats: ['es', 'cjs'],
      fileName: (format, entryName) => `${entryName}.${format}.js`
    },
    rollupOptions: {
      external: [
        'react',
        'react-dom',
        'vue',
        /^node:*/,
        /^@types\/.*/
      ],
      output: {
        globals: {
          react: 'React',
          'react-dom': 'ReactDOM'
        }
      }
    },
    sourcemap: true,
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,
        drop_debugger: true
      }
    }
  },
  resolve: {
    alias: {
      '@': resolve(__dirname, 'src'),
      '@/types': resolve(__dirname, 'src/types'),
      '@/utils': resolve(__dirname, 'src/utils'),
      '@/components': resolve(__dirname, 'src/components')
    }
  },
  define: {
    __VERSION__: JSON.stringify(process.env.npm_package_version)
  }
});
```

## 3. TypeScript é«˜çº§é…ç½®

### 3.1 å¤šç¯å¢ƒé…ç½®

```json
// tsconfig.json
{
  "extends": "./tsconfig.base.json",
  "compilerOptions": {
    "outDir": "./dist",
    "rootDir": "./src"
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "dist", "**/*.test.ts", "**/*.spec.ts"]
}
```

```json
// tsconfig.base.json
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2022", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "moduleResolution": "bundler",
    "allowSyntheticDefaultImports": true,
    "esModuleInterop": true,
    "allowJs": true,
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "strictBindCallApply": true,
    "strictPropertyInitialization": true,
    "noImplicitThis": true,
    "alwaysStrict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "exactOptionalPropertyTypes": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedIndexedAccess": true,
    "noImplicitOverride": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "removeComments": false,
    "importHelpers": true,
    "experimentalDecorators": true,
    "emitDecoratorMetadata": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "verbatimModuleSyntax": true,
    "baseUrl": "./src",
    "paths": {
      "@/*": ["*"],
      "@/types/*": ["types/*"],
      "@/utils/*": ["utils/*"],
      "@/components/*": ["components/*"],
      "@/hooks/*": ["hooks/*"],
      "@/services/*": ["services/*"]
    }
  }
}
```

```json
// tsconfig.build.json
{
  "extends": "./tsconfig.base.json",
  "compilerOptions": {
    "noEmit": false,
    "declaration": true,
    "declarationMap": true,
    "emitDeclarationOnly": false,
    "outDir": "./dist"
  },
  "include": ["src/**/*"],
  "exclude": [
    "src/**/*.test.ts",
    "src/**/*.spec.ts",
    "src/**/*.stories.ts",
    "src/**/*.bench.ts"
  ]
}
```

### 3.2 è·¯å¾„åˆ«åé…ç½®

```typescript
// src/utils/module-resolver.ts
import { resolve } from 'path';
import { fileURLToPath } from 'url';

const __dirname = fileURLToPath(new URL('.', import.meta.url));

export const paths = {
  src: resolve(__dirname, '../src'),
  types: resolve(__dirname, '../src/types'),
  utils: resolve(__dirname, '../src/utils'),
  components: resolve(__dirname, '../src/components'),
  hooks: resolve(__dirname, '../src/hooks'),
  services: resolve(__dirname, '../src/services'),
  middleware: resolve(__dirname, '../src/middleware')
};

export function createAliasMap() {
  return {
    '@': paths.src,
    '@/types': paths.types,
    '@/utils': paths.utils,
    '@/components': paths.components,
    '@/hooks': paths.hooks,
    '@/services': paths.services,
    '@/middleware': paths.middleware
  };
}
```

## 4. åŒç‰ˆæœ¬åŒ…æ„å»º

### 4.1 ESM/CJS å…¼å®¹æ€§å¤„ç†

```typescript
// src/index.ts
// ä¸»è¦å¯¼å‡ºæ–‡ä»¶ - åŒæ—¶æ”¯æŒ ESM å’Œ CJS
export { default as createLogger } from './logger';
export { LogLevel, LogFormat } from './types';
export type { LoggerConfig, LogEntry } from './types';

// å·¥å…·å‡½æ•°
export * from './utils';
export * from './middleware';

// é»˜è®¤å¯¼å‡º
import createLogger from './logger';
export default createLogger;
```

```typescript
// src/cjs-adapter.ts
// CommonJS é€‚é…å™¨
import { createLogger } from './index';

// ä¸ºäº† CommonJS å…¼å®¹æ€§
module.exports = createLogger;
module.exports.createLogger = createLogger;
module.exports.default = createLogger;

// ç±»å‹å¯¼å‡º
import type { LoggerConfig, LogLevel, LogFormat } from './types';
export type { LoggerConfig, LogLevel, LogFormat };
```

### 4.2 åŒ…é…ç½®æ–‡ä»¶

```json
// package.json
{
  "name": "@your-org/ts-engineering-demo",
  "version": "1.0.0",
  "description": "TypeScript engineering demo package",
  "type": "module",
  "main": "./dist/index.cjs",
  "module": "./dist/index.js",
  "types": "./dist/index.d.ts",
  "exports": {
    ".": {
      "import": {
        "types": "./dist/index.d.ts",
        "default": "./dist/index.js"
      },
      "require": {
        "types": "./dist/index.d.cts",
        "default": "./dist/index.cjs"
      },
      "default": {
        "types": "./dist/index.d.ts",
        "default": "./dist/index.js"
      }
    },
    "./utils": {
      "import": {
        "types": "./dist/utils.d.ts",
        "default": "./dist/utils.js"
      },
      "require": {
        "types": "./dist/utils.d.cts",
        "default": "./dist/utils.cjs"
      }
    },
    "./package.json": "./package.json"
  },
  "files": [
    "dist",
    "README.md",
    "LICENSE"
  ],
  "engines": {
    "node": ">=14.0.0"
  },
  "publishConfig": {
    "access": "public",
    "registry": "https://registry.npmjs.org/"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/your-org/ts-engineering-demo.git"
  },
  "keywords": [
    "typescript",
    "engineering",
    "tooling",
    "build-tools"
  ],
  "author": {
    "name": "Your Name",
    "email": "your.email@example.com"
  },
  "license": "MIT"
}
```

## 5. CI/CD é›†æˆ

### 5.1 GitHub Actions é…ç½®

```yaml
# .github/workflows/ci.yml
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]
  release:
    types: [published]

jobs:
  test:
    name: Test
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [18.x, 20.x]
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node-version }}
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Type check
        run: npm run typecheck
      
      - name: Lint
        run: npm run lint
      
      - name: Test
        run: npm run test:coverage
      
      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info
          flags: unittests
          name: codecov-umbrella

  build:
    name: Build
    runs-on: ubuntu-latest
    needs: test
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Build
        run: npm run build
      
      - name: Build types
        run: npm run build:types
      
      - name: Upload build artifacts
        uses: actions/upload-artifact@v3
        with:
          name: dist
          path: dist/

  publish:
    name: Publish
    runs-on: ubuntu-latest
    needs: build
    if: github.event_name == 'release'
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
          cache: 'npm'
          registry-url: 'https://registry.npmjs.org'
      
      - name: Install dependencies
        run: npm ci
      
      - name: Download build artifacts
        uses: actions/download-artifact@v3
        with:
          name: dist
          path: dist/
      
      - name: Publish to NPM
        run: npm publish --access public
        env:
          NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
```

### 5.2 è´¨é‡é—¨ç¦è„šæœ¬

```typescript
// scripts/quality-gate.ts
import { execSync } from 'child_process';
import { readFileSync, existsSync } from 'fs';
import { join } from 'path';

interface QualityMetrics {
  typescript: boolean;
  eslint: boolean;
  prettier: boolean;
  tests: boolean;
  coverage: boolean;
  bundleSize: boolean;
}

class QualityGate {
  private metrics: QualityMetrics = {
    typescript: false,
    eslint: false,
    prettier: false,
    tests: false,
    coverage: false,
    bundleSize: false
  };

  async checkTypeScript(): Promise<void> {
    try {
      execSync('npm run typecheck', { stdio: 'pipe' });
      this.metrics.typescript = true;
      console.log('âœ… TypeScript compilation passed');
    } catch (error) {
      console.error('âŒ TypeScript compilation failed');
      throw error;
    }
  }

  async checkESLint(): Promise<void> {
    try {
      execSync('npm run lint', { stdio: 'pipe' });
      this.metrics.eslint = true;
      console.log('âœ… ESLint checks passed');
    } catch (error) {
      console.error('âŒ ESLint checks failed');
      throw error;
    }
  }

  async checkPrettier(): Promise<void> {
    try {
      execSync('npx prettier --check "src/**/*.{ts,tsx,json,md}"', { stdio: 'pipe' });
      this.metrics.prettier = true;
      console.log('âœ… Prettier checks passed');
    } catch (error) {
      console.error('âŒ Prettier checks failed');
      throw error;
    }
  }

  async checkTests(): Promise<void> {
    try {
      execSync('npm run test', { stdio: 'pipe' });
      this.metrics.tests = true;
      console.log('âœ… All tests passed');
    } catch (error) {
      console.error('âŒ Some tests failed');
      throw error;
    }
  }

  async checkCoverage(): Promise<void> {
    try {
      const coveragePath = join(process.cwd(), 'coverage', 'coverage-summary.json');
      if (!existsSync(coveragePath)) {
        throw new Error('Coverage report not found');
      }

      const coverage = JSON.parse(readFileSync(coveragePath, 'utf-8'));
      const totalCoverage = coverage.total.statements.pct;

      if (totalCoverage < 80) {
        throw new Error(`Coverage ${totalCoverage}% is below 80% threshold`);
      }

      this.metrics.coverage = true;
      console.log(`âœ… Coverage ${totalCoverage}% passed`);
    } catch (error) {
      console.error('âŒ Coverage check failed');
      throw error;
    }
  }

  async checkBundleSize(): Promise<void> {
    try {
      const packageJsonPath = join(process.cwd(), 'package.json');
      const packageJson = JSON.parse(readFileSync(packageJsonPath, 'utf-8'));
      
      // æ£€æŸ¥åŒ…å¤§å°é™åˆ¶
      execSync('npm run build', { stdio: 'pipe' });
      
      // è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤æ‚çš„å¤§å°æ£€æŸ¥é€»è¾‘
      this.metrics.bundleSize = true;
      console.log('âœ… Bundle size check passed');
    } catch (error) {
      console.error('âŒ Bundle size check failed');
      throw error;
    }
  }

  async runAll(): Promise<void> {
    console.log('ğŸš€ Running quality gate checks...\n');

    try {
      await this.checkTypeScript();
      await this.checkESLint();
      await this.checkPrettier();
      await this.checkTests();
      await this.checkCoverage();
      await this.checkBundleSize();

      console.log('\nğŸ‰ All quality gate checks passed!');
      console.log('Summary:', JSON.stringify(this.metrics, null, 2));
    } catch (error) {
      console.error('\nğŸ’¥ Quality gate failed!');
      console.log('Summary:', JSON.stringify(this.metrics, null, 2));
      process.exit(1);
    }
  }
}

// å¦‚æœç›´æ¥è¿è¡Œæ­¤è„šæœ¬
if (require.main === module) {
  const qualityGate = new QualityGate();
  qualityGate.runAll().catch(console.error);
}

export { QualityGate };
```

## 6. å®æˆ˜ï¼šå®Œæ•´å·¥ç¨‹åŒ–åŒ…

### 6.1 é¡¹ç›®ç»“æ„

```
ts-engineering-demo/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts                 # ä¸»å…¥å£
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ api.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â””â”€â”€ helpers.ts
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useApi.ts
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ api.ts
â”‚       â””â”€â”€ index.ts
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ integration/
â”‚   â””â”€â”€ fixtures/
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ build.ts
â”‚   â”œâ”€â”€ quality-gate.ts
â”‚   â””â”€â”€ release.ts
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ api.md
â”‚   â””â”€â”€ examples.md
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ tsconfig.base.json
â”œâ”€â”€ tsconfig.build.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tsup.config.ts
â”œâ”€â”€ .eslintrc.json
â”œâ”€â”€ .prettierrc
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

### 6.2 è‡ªåŠ¨åŒ–å‘å¸ƒè„šæœ¬

```typescript
// scripts/release.ts
import { execSync } from 'child_process';
import { readFileSync, writeFileSync } from 'fs';
import { join } from 'path';
import semver from 'semver';

class ReleaseManager {
  private packageJsonPath: string;
  private packageJson: any;

  constructor() {
    this.packageJsonPath = join(process.cwd(), 'package.json');
    this.packageJson = JSON.parse(readFileSync(this.packageJsonPath, 'utf-8'));
  }

  getCurrentVersion(): string {
    return this.packageJson.version;
  }

  bumpVersion(type: 'patch' | 'minor' | 'major'): string {
    const currentVersion = this.getCurrentVersion();
    const newVersion = semver.inc(currentVersion, type);
    
    if (!newVersion) {
      throw new Error(`Failed to bump version from ${currentVersion}`);
    }

    this.packageJson.version = newVersion;
    writeFileSync(this.packageJsonPath, JSON.stringify(this.packageJson, null, 2));
    
    console.log(`Version bumped from ${currentVersion} to ${newVersion}`);
    return newVersion;
  }

  async createRelease(version: string, type: 'patch' | 'minor' | 'major'): Promise<void> {
    console.log(`ğŸš€ Creating ${type} release ${version}...`);

    try {
      // 1. è¿è¡Œè´¨é‡é—¨ç¦
      console.log('Running quality gate checks...');
      execSync('node scripts/quality-gate.ts', { stdio: 'inherit' });

      // 2. æ„å»ºé¡¹ç›®
      console.log('Building project...');
      execSync('npm run build', { stdio: 'inherit' });

      // 3. è¿è¡Œæµ‹è¯•
      console.log('Running tests...');
      execSync('npm test', { stdio: 'inherit' });

      // 4. æäº¤ç‰ˆæœ¬å˜æ›´
      console.log('Committing version changes...');
      execSync('git add package.json', { stdio: 'inherit' });
      execSync(`git commit -m "chore: bump version to ${version}"`, { stdio: 'inherit' });

      // 5. åˆ›å»ºæ ‡ç­¾
      console.log(`Creating tag v${version}...`);
      execSync(`git tag v${version}`, { stdio: 'inherit' });

      // 6. æ¨é€åˆ°è¿œç¨‹
      console.log('Pushing to remote...');
      execSync('git push origin main --tags', { stdio: 'inherit' });

      // 7. å‘å¸ƒåˆ° NPM
      console.log('Publishing to NPM...');
      execSync('npm publish', { stdio: 'inherit' });

      console.log(`âœ… Release ${version} completed successfully!`);
    } catch (error) {
      console.error('âŒ Release failed:', error);
      process.exit(1);
    }
  }

  async releasePatch(): Promise<void> {
    const version = this.bumpVersion('patch');
    await this.createRelease(version, 'patch');
  }

  async releaseMinor(): Promise<void> {
    const version = this.bumpVersion('minor');
    await this.createRelease(version, 'minor');
  }

  async releaseMajor(): Promise<void> {
    const version = this.bumpVersion('major');
    await this.createRelease(version, 'major');
  }
}

// CLI å¤„ç†
async function main() {
  const command = process.argv[2];
  const releaseManager = new ReleaseManager();

  switch (command) {
    case 'patch':
      await releaseManager.releasePatch();
      break;
    case 'minor':
      await releaseManager.releaseMinor();
      break;
    case 'major':
      await releaseManager.releaseMajor();
      break;
    default:
      console.log('Usage: npm run release [patch|minor|major]');
      process.exit(1);
  }
}

if (require.main === module) {
  main().catch(console.error);
}

export { ReleaseManager };
```

## ğŸ“‹ å®æˆ˜ä½œä¸šï¼šåŒç‰ˆæœ¬åŒ…æ„å»ºä¸å‘å¸ƒ

### ä½œä¸šè¦æ±‚

1. **æ„å»ºå·¥å…·é…ç½®**
   - é…ç½® ESLint + TypeScript é›†æˆ
   - è®¾ç½® tsup å’Œ Vite æ„å»ºé…ç½®
   - å®ç°è·¯å¾„åˆ«åå’Œæ¨¡å—è§£æ
   - é…ç½®å¤šç¯å¢ƒ TypeScript ç¼–è¯‘

2. **åŒç‰ˆæœ¬åŒ…æ”¯æŒ**
   - å®ç° ESM/CJS åŒç‰ˆæœ¬è¾“å‡º
   - é…ç½®æ­£ç¡®çš„ package.json exports
   - åˆ›å»ºç±»å‹å£°æ˜æ–‡ä»¶
   - å¤„ç†å…¼å®¹æ€§é—®é¢˜

3. **CI/CD æµæ°´çº¿**
   - è®¾ç½® GitHub Actions å·¥ä½œæµ
   - å®ç°è‡ªåŠ¨åŒ–æµ‹è¯•å’Œæ„å»º
   - é…ç½®ä»£ç è´¨é‡é—¨ç¦
   - å®ç°è‡ªåŠ¨åŒ–å‘å¸ƒæµç¨‹

### å®ç°æ­¥éª¤

1. **é…ç½®å¼€å‘ç¯å¢ƒ**
   ```json
   {
     "scripts": {
       "dev": "vite",
       "build": "tsup",
       "build:types": "tsc --declarationOnly",
       "lint": "eslint src --ext .ts",
       "test": "jest"
     }
   }
   ```

2. **è®¾ç½®æ„å»ºå·¥å…·**
   - é…ç½® tsup å¤šæ ¼å¼è¾“å‡º
   - è®¾ç½® Vite å¼€å‘æœåŠ¡å™¨
   - é…ç½®è·¯å¾„åˆ«å
   - å®ç°æ„å»ºä¼˜åŒ–

3. **åˆ›å»º CI/CD æµç¨‹**
   - è®¾ç½®è‡ªåŠ¨åŒ–æµ‹è¯•
   - é…ç½®ä»£ç è´¨é‡æ£€æŸ¥
   - å®ç°è‡ªåŠ¨åŒ–å‘å¸ƒ
   - æ·»åŠ ç‰ˆæœ¬ç®¡ç†

### éªŒæ”¶æ ‡å‡†

- [ ] ESLint å’Œ TypeScript é›†æˆæ­£å¸¸
- [ ] å¤šæ ¼å¼æ„å»ºè¾“å‡ºæ­£ç¡®
- [ ] è·¯å¾„åˆ«åè§£ææ­£å¸¸
- [ ] ESM/CJS å…¼å®¹æ€§è‰¯å¥½
- [ ] CI/CD æµæ°´çº¿å®Œæ•´
- [ ] è‡ªåŠ¨åŒ–å‘å¸ƒæµç¨‹æ­£å¸¸

### æ‰©å±•æŒ‘æˆ˜

1. é›†æˆ Storybook æ–‡æ¡£ç”Ÿæˆ
2. å®ç°ä¾èµ–è‡ªåŠ¨æ›´æ–°æ£€æŸ¥
3. æ·»åŠ æ€§èƒ½ç›‘æ§å’ŒæŠ¥å‘Š
4. å®ç°å¤šåŒ… monorepo ç®¡ç†
5. é›†æˆè‡ªåŠ¨åŒ– API æ–‡æ¡£ç”Ÿæˆ

## ğŸ¯ æ€»ç»“

æœ¬è¯¾æ—¶æˆ‘ä»¬æ·±å…¥å­¦ä¹ äº† TypeScript çš„å·¥ç¨‹åŒ–é›†æˆï¼š

- **ä»£ç è´¨é‡**ï¼šESLint + TypeScript é›†æˆé…ç½®
- **æ„å»ºå·¥å…·**ï¼štsupã€Vite ç­‰ç°ä»£æ„å»ºå·¥å…·
- **è·¯å¾„è§£æ**ï¼šæ¨¡å—åˆ«åå’Œè§£æé…ç½®
- **åŒç‰ˆæœ¬åŒ…**ï¼šESM/CJS å…¼å®¹æ€§å¤„ç†
- **CI/CD**ï¼šè‡ªåŠ¨åŒ–æµæ°´çº¿å’Œè´¨é‡é—¨ç¦
- **å·¥ç¨‹åŒ–**ï¼šå®Œæ•´çš„åŒ…å‘å¸ƒæµç¨‹

é€šè¿‡æœ¬è¯¾æ—¶çš„å­¦ä¹ ï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š
1. é…ç½®å®Œæ•´çš„ TypeScript å·¥ç¨‹ç¯å¢ƒ
2. å®ç°å¤šæ ¼å¼æ„å»ºè¾“å‡º
3. è®¾ç½®è‡ªåŠ¨åŒ–è´¨é‡æ£€æŸ¥
4. æ„å»º CI/CD æµæ°´çº¿
5. å‘å¸ƒä¸“ä¸šçš„ TypeScript åŒ…

ä¸‹ä¸€è¯¾æ—¶æˆ‘ä»¬å°†å®Œæˆ Capstone é¡¹ç›®ï¼Œè¿ç”¨æ‰€å­¦çŸ¥è¯†æ„å»ºå®Œæ•´çš„åº”ç”¨ã€‚
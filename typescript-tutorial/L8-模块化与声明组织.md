# L8 - 模块化与声明组织

## 本课时目标
- 理解 TypeScript 的模块系统
- 掌握模块解析策略
- 学会组织大型项目的类型声明
- 实现一个可复用的公共类型包

## 1. ES 模块系统

### 1.1 基本导入导出

```typescript
// user.ts - 导出单个绑定
export interface User {
  id: string;
  name: string;
  email: string;
}

export class UserService {
  constructor(private baseUrl: string) {}
  
  async getUser(id: string): Promise<User> {
    const response = await fetch(`${this.baseUrl}/users/${id}`);
    return response.json();
  }
}

// utils.ts - 导出多个绑定
export const formatDate = (date: Date): string => {
  return date.toISOString().split('T')[0];
};

export const validateEmail = (email: string): boolean => {
  return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
};

// 重命名导出
export { formatDate as formatDateString, validateEmail };

// 重新导出其他模块
export { User, UserService } from './user';
export * from './constants';

// index.ts - 桶文件（Barrel File）
export { User, UserService } from './user';
export { formatDate, validateEmail } from './utils';
export * from './types';
```

### 1.2 导入语法

```typescript
// 命名导入
import { User, UserService } from './user';
import { formatDate, validateEmail as isValidEmail } from './utils';

// 默认导入
import UserService from './user-service';
import React from 'react';

// 命名导入 + 默认导入
import UserService, { User } from './user-service';

// 命名空间导入
import * as UserModule from './user';
const user: UserModule.User = { id: '1', name: 'Alice', email: 'alice@example.com' };

// 动态导入
async function loadUserService() {
  const { UserService } = await import('./user-service');
  return new UserService('https://api.example.com');
}

// 条件导入
async function loadFeature(feature: string) {
  if (feature === 'admin') {
    const adminModule = await import('./features/admin');
    return adminModule.AdminPanel;
  }
  return null;
}
```

### 1.3 模块作用域

```typescript
// config.ts - 模块作用域变量
const API_BASE_URL = 'https://api.example.com';
const DEFAULT_TIMEOUT = 5000;

// 导出配置
export const config = {
  apiUrl: API_BASE_URL,
  timeout: DEFAULT_TIMEOUT
};

// 私有辅助函数
function buildHeaders(authToken?: string): Record<string, string> {
  const headers: Record<string, string> = {
    'Content-Type': 'application/json'
  };
  
  if (authToken) {
    headers.Authorization = `Bearer ${authToken}`;
  }
  
  return headers;
}

// 导出公共 API
export async function apiRequest<T>(
  endpoint: string,
  options: RequestInit = {},
  authToken?: string
): Promise<T> {
  const response = await fetch(`${API_BASE_URL}${endpoint}`, {
    ...options,
    headers: { ...buildHeaders(authToken), ...options.headers }
  });
  
  return response.json();
}

// api.ts - 使用模块作用域
import { apiRequest } from './config';

export const userApi = {
  async getUser(id: string): Promise<User> {
    return apiRequest(`/users/${id}`);
  },
  
  async createUser(userData: Omit<User, 'id'>): Promise<User> {
    return apiRequest('/users', {
      method: 'POST',
      body: JSON.stringify(userData)
    });
  }
};
```

## 2. 模块解析策略

### 2.1 相对路径和绝对路径

```typescript
// 项目结构
/*
src/
├── components/
│   ├── Button/
│   │   ├── Button.tsx
│   │   ├── Button.module.css
│   │   └── index.ts
│   └── Form/
│       ├── Form.tsx
│       ├── Form.module.css
│       └── index.ts
├── utils/
│   ├── date.ts
│   ├── validation.ts
│   └── index.ts
├── types/
│   ├── user.ts
│   ├── api.ts
│   └── index.ts
└── services/
    ├── api.ts
    └── index.ts
*/

// 相对路径导入
import { Button } from '../Button';
import { formatDate } from '../../utils/date';
import { User } from '../../types/user';

// 绝对路径导入（需要配置 tsconfig.json）
import { Button } from '@/components/Button';
import { formatDate } from '@/utils/date';
import { User } from '@/types/user';
```

### 2.2 TypeScript 配置

```json
// tsconfig.json
{
  "compilerOptions": {
    "baseUrl": ".",           // 解析的基础目录
    "paths": {                // 路径映射
      "@/*": ["src/*"],       // @ 映射到 src
      "@/components/*": ["src/components/*"],
      "@/utils/*": ["src/utils/*"],
      "@/types/*": ["src/types/*"]
    },
    "moduleResolution": "node",  // 模块解析策略
    "typeRoots": [              // 类型声明目录
      "./node_modules/@types",
      "./src/types"
    ],
    "types": [                  // 全局类型包
      "node",
      "jest"
    ]
  },
  "include": [
    "src/**/*"
  ],
  "exclude": [
    "node_modules",
    "dist"
  ]
}
```

### 2.3 模块解析策略

```typescript
// Classic 策略（默认）
// 相对路径：相对于当前文件
// 绝对路径：相对于 baseUrl 或从 node_modules 查找

// Node 策略（推荐）
// 类似 Node.js 的 require() 算法
// 支持 package.json 的 main、types、exports 字段
// 支持目录索引文件（index.js/index.d.ts）

// package.json 示例
{
  "name": "@company/types",
  "version": "1.0.0",
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "exports": {
    ".": {
      "types": "./dist/index.d.ts",
      "default": "./dist/index.js"
    },
    "./utils": {
      "types": "./dist/utils.d.ts",
      "default": "./dist/utils.js"
    }
  },
  "files": [
    "dist/**/*"
  ]
}
```

## 3. 类型声明文件组织

### 3.1 类型声明文件结构

```typescript
// types/global.d.ts - 全局类型声明
declare global {
  namespace App {
    interface User {
      id: string;
      name: string;
      email: string;
    }
    
    interface Config {
      apiUrl: string;
      version: string;
      environment: 'development' | 'production';
    }
  }
  
  // 扩展 Window 对象
  interface Window {
    __APP_CONFIG__: App.Config;
    gtag: (command: string, targetId: string, config?: any) => void;
  }
  
  // 模块声明
  namespace NodeJS {
    interface ProcessEnv {
      NODE_ENV: 'development' | 'production' | 'test';
      API_URL: string;
      JWT_SECRET: string;
    }
  }
}

export {}; // 确保文件被视为模块

// types/env.d.ts - 环境变量类型
declare const __DEV__: boolean;
declare const __PROD__: boolean;
declare const __TEST__: boolean;

// types/api.d.ts - API 相关类型
export namespace Api {
  interface Response<T = any> {
    data: T;
    status: number;
    message: string;
  }
  
  interface Error {
    code: string;
    message: string;
    details?: any;
  }
  
  type Method = 'GET' | 'POST' | 'PUT' | 'DELETE' | 'PATCH';
}

// types/react.d.ts - React 扩展类型
import { ComponentType } from 'react';

declare module '*.svg' {
  const content: React.FunctionComponent<React.SVGAttributes<SVGElement>>;
  export default content;
}

declare module '*.module.css' {
  const classes: { readonly [key: string]: string };
  export default classes;
}

// 增强的组件 Props
declare module 'react' {
  interface HTMLAttributes<T> extends AriaAttributes, DOMAttributes<T> {
    // 扩展 HTML 属性
    'data-testid'?: string;
    'data-cy'?: string;
  }
}
```

### 3.2 模块声明

```typescript
// types/modules/third-party.d.ts - 第三方库声明
declare module 'some-untyped-library' {
  export interface SomeInterface {
    method(): void;
    property: string;
  }
  
  export function createSomething(): SomeInterface;
  export const VERSION: string;
}

// 声明模块的所有导出
declare module 'another-library/*' {
  // 匹配 any-string/any-file.js
  export default function factory(...args: any[]): any;
}

// 声明全局变量
declare var analytics: {
  track(event: string, properties?: Record<string, any>): void;
  identify(userId: string, traits?: Record<string, any>): void;
  page(category?: string, name?: string, properties?: Record<string, any>): void;
};

// types/modules/custom.d.ts - 自定义模块声明
declare module '@/services/api' {
  export interface ApiService {
    get<T>(url: string): Promise<T>;
    post<T>(url: string, data: any): Promise<T>;
    put<T>(url: string, data: any): Promise<T>;
    delete<T>(url: string): Promise<T>;
  }
  
  export const apiService: ApiService;
}
```

### 3.3 类型定义目录结构

```typescript
// types/index.ts - 类型包入口
export * from './api';
export * from './user';
export * from './config';
export * from './utils';

// types/api/index.ts - API 类型导出
export * from './request';
export * from './response';
export * from './errors';

// types/api/request.ts - 请求类型
export interface ApiRequest {
  method: 'GET' | 'POST' | 'PUT' | 'DELETE';
  url: string;
  headers?: Record<string, string>;
  params?: Record<string, any>;
  data?: any;
}

export interface RequestOptions {
  timeout?: number;
  retries?: number;
  cache?: boolean;
}

// types/api/response.ts - 响应类型
export interface ApiResponse<T = any> {
  data: T;
  status: number;
  statusText: string;
  headers: Record<string, string>;
}

export interface PaginatedResponse<T> extends ApiResponse<T[]> {
  meta: {
    total: number;
    page: number;
    limit: number;
    totalPages: number;
  };
}
```

## 4. 命名空间与模块

### 4.1 命名空间使用

```typescript
// namespace/global-types.ts - 全局命名空间
namespace App.Types {
  export interface User {
    id: string;
    name: string;
    email: string;
  }
  
  export interface Product {
    id: string;
    name: string;
    price: number;
  }
  
  export namespace User {
    export interface CreateRequest {
      name: string;
      email: string;
      password: string;
    }
    
    export interface UpdateRequest {
      name?: string;
      email?: string;
    }
  }
}

// 使用命名空间
function createUser(userData: App.Types.User.CreateRequest): App.Types.User {
  return {
    id: generateId(),
    ...userData
  };
}

// 嵌套命名空间
namespace App.UI {
  export namespace Components {
    export interface BaseProps {
      className?: string;
      'data-testid'?: string;
    }
    
    export interface ButtonProps extends BaseProps {
      variant: 'primary' | 'secondary';
      onClick: () => void;
      children: React.ReactNode;
    }
  }
  
  export namespace Hooks {
    export interface UseApiResult<T> {
      data: T | null;
      loading: boolean;
      error: Error | null;
      refetch: () => Promise<void>;
    }
  }
}
```

### 4.2 模块命名空间

```typescript
// utils/validation.ts - 模块内部命名空间
export namespace Validation {
  export interface Rule {
    validate(value: any): boolean;
    message: string;
  }
  
  export const rules = {
    required: (message = 'This field is required'): Rule => ({
      validate: (value) => value !== null && value !== undefined && value !== '',
      message
    }),
    
    email: (message = 'Invalid email format'): Rule => ({
      validate: (value) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value),
      message
    }),
    
    minLength: (min: number, message?: string): Rule => ({
      validate: (value) => value && value.length >= min,
      message: message || `Must be at least ${min} characters`
    })
  };
  
  export function validate(value: any, ruleset: Rule[]): string[] {
    return ruleset
      .filter(rule => !rule.validate(value))
      .map(rule => rule.message);
  }
}

// 使用
import { Validation } from './utils/validation';

const errors = Validation.validate('test@example.com', [
  Validation.rules.required(),
  Validation.rules.email()
]);
```

## 5. 实战：公共类型包

### 5.1 项目结构设计

```
@company/types/
├── src/
│   ├── api/
│   │   ├── index.ts
│   │   ├── request.ts
│   │   ├── response.ts
│   │   └── errors.ts
│   ├── domain/
│   │   ├── index.ts
│   │   ├── user.ts
│   │   ├── product.ts
│   │   └── order.ts
│   ├── ui/
│   │   ├── index.ts
│   │   ├── components.ts
│   │   ├── forms.ts
│   │   └── themes.ts
│   ├── utils/
│   │   ├── index.ts
│   │   ├── validation.ts
│   │   └── helpers.ts
│   └── index.ts
├── package.json
├── tsconfig.json
└── README.md
```

### 5.2 核心类型定义

```typescript
// src/domain/user.ts - 用户领域类型
export namespace User {
  export interface Base {
    id: string;
    createdAt: Date;
    updatedAt: Date;
  }
  
  export interface Profile extends Base {
    firstName: string;
    lastName: string;
    email: string;
    avatar?: string;
    dateOfBirth?: Date;
    phone?: string;
  }
  
  export interface Preferences {
    theme: 'light' | 'dark' | 'auto';
    language: string;
    timezone: string;
    notifications: {
      email: boolean;
      push: boolean;
      sms: boolean;
    };
    privacy: {
      profileVisible: boolean;
      showEmail: boolean;
      showPhone: boolean;
    };
  }
  
  export interface Role {
    id: string;
    name: string;
    permissions: Permission[];
    level: number;
  }
  
  export interface Permission {
    id: string;
    resource: string;
    action: string;
    conditions?: Record<string, any>;
  }
  
  export interface FullUser extends Profile {
    roles: Role[];
    preferences: Preferences;
    lastLoginAt?: Date;
    status: 'active' | 'inactive' | 'suspended' | 'deleted';
  }
  
  // DTO 类型
  export interface CreateRequest {
    firstName: string;
    lastName: string;
    email: string;
    password: string;
  }
  
  export interface UpdateRequest {
    firstName?: string;
    lastName?: string;
    avatar?: string;
    dateOfBirth?: Date;
    phone?: string;
  }
  
  export interface PreferencesUpdateRequest {
    theme?: Preferences['theme'];
    language?: string;
    timezone?: string;
    notifications?: Partial<Preferences['notifications']>;
    privacy?: Partial<Preferences['privacy']>;
  }
}

// src/api/response.ts - API 响应类型
export namespace Api {
  export interface BaseResponse<T = any> {
    data: T;
    meta: {
      timestamp: number;
      requestId: string;
      version: string;
    };
  }
  
  export interface SuccessResponse<T> extends BaseResponse<T> {
    success: true;
    status: number;
    statusText: string;
  }
  
  export interface ErrorResponse {
    success: false;
    error: {
      code: string;
      message: string;
      details?: any;
      stack?: string;
    };
    meta: {
      timestamp: number;
      requestId: string;
      version: string;
    };
  }
  
  export interface PaginatedResponse<T> extends SuccessResponse<T[]> {
    data: T[];
    pagination: {
      page: number;
      limit: number;
      total: number;
      totalPages: number;
      hasNext: boolean;
      hasPrev: boolean;
    };
  }
  
  export type ApiResponse<T> = SuccessResponse<T> | ErrorResponse;
  export type PaginatedApiResponse<T> = PaginatedResponse<T> | ErrorResponse;
}
```

### 5.3 工具类型库

```typescript
// src/utils/validation.ts - 验证类型
export namespace Validation {
  export interface Rule<T = any> {
    validate: (value: T) => boolean | Promise<boolean>;
    message: string;
  }
  
  export interface ValidationSchema<T> {
    [K in keyof T]: Rule<T[K]> | ValidationSchema<T[K]>;
  }
  
  export interface ValidationResult<T> {
    isValid: boolean;
    data?: T;
    errors: {
      field: keyof T;
      message: string;
    }[];
  }
  
  // 内置验证规则
  export const rules = {
    required: <T>(message = 'This field is required'): Rule<T> => ({
      validate: (value) => value !== null && value !== undefined && value !== '',
      message
    }),
    
    email: (message = 'Invalid email format'): Rule<string> => ({
      validate: (value) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value),
      message
    }),
    
    minLength: (min: number, message?: string): Rule<string> => ({
      validate: (value) => value && value.length >= min,
      message: message || `Must be at least ${min} characters`
    }),
    
    maxLength: (max: number, message?: string): Rule<string> => ({
      validate: (value) => !value || value.length <= max,
      message: message || `Must be at most ${max} characters`
    }),
    
    pattern: (regex: RegExp, message = 'Invalid format'): Rule<string> => ({
      validate: (value) => regex.test(value),
      message
    }),
    
    min: (min: number, message?: string): Rule<number> => ({
      validate: (value) => value !== undefined && value >= min,
      message: message || `Must be at least ${min}`
    }),
    
    max: (max: number, message?: string): Rule<number> => ({
      validate: (value) => value !== undefined && value <= max,
      message: message || `Must be at most ${max}`
    })
  };
}

// src/utils/helpers.ts - 辅助类型
export namespace Helpers {
  // 基础类型工具
  export type Optional<T, K extends keyof T> = Omit<T, K> & Partial<Pick<T, K>>;
  export type Required<T, K extends keyof T> = Omit<T, K> & Required<Pick<T, K>>;
  
  // 深度类型工具
  export type DeepPartial<T> = {
    [K in keyof T]?: T[K] extends object ? DeepPartial<T[K]> : T[K];
  };
  
  export type DeepRequired<T> = {
    [K in keyof T]-?: T[K] extends object ? DeepRequired<T[K]> : T[K];
  };
  
  // 函数类型工具
  export type AsyncFunction<T extends any[] = any[], R = any> = (...args: T) => Promise<R>;
  export type EventHandler<E = Event> = (event: E) => void;
  export type AsyncCallback<T = void> = (error?: Error | null, result?: T) => void;
  
  // 条件类型
  export type NonNullable<T> = T extends null | undefined ? never : T;
  export type Maybe<T> = T | null | undefined;
  
  // 工具类型
  export type ID = string;
  export type Timestamp = number;
  export type ISOString = string;
  
  // 状态类型
  export type LoadingState = 'idle' | 'loading' | 'success' | 'error';
  export type RequestState<T> = {
    data: T | null;
    loading: boolean;
    error: Error | null;
  };
}
```

### 5.4 UI 组件类型

```typescript
// src/ui/components.ts - UI 组件类型
export namespace UI {
  // 基础组件属性
  export interface BaseComponentProps {
    className?: string;
    'data-testid'?: string;
    'data-cy'?: string;
  }
  
  export interface SizeProps {
    size?: 'xs' | 'sm' | 'md' | 'lg' | 'xl';
  }
  
  export interface ColorProps {
    color?: 'primary' | 'secondary' | 'success' | 'warning' | 'error' | 'info';
  }
  
  export interface VariantProps {
    variant?: 'default' | 'outline' | 'ghost' | 'link';
  }
  
  // 通用组件类型
  export interface ButtonProps extends BaseComponentProps, SizeProps, ColorProps, VariantProps {
    type?: 'button' | 'submit' | 'reset';
    disabled?: boolean;
    loading?: boolean;
    onClick?: (event: React.MouseEvent<HTMLButtonElement>) => void;
    children: React.ReactNode;
  }
  
  export interface InputProps extends BaseComponentProps, SizeProps {
    type?: 'text' | 'email' | 'password' | 'number' | 'tel' | 'url';
    placeholder?: string;
    value?: string;
    defaultValue?: string;
    disabled?: boolean;
    required?: boolean;
    error?: boolean;
    helperText?: string;
    onChange?: (event: React.ChangeEvent<HTMLInputElement>) => void;
  }
  
  export interface SelectProps<T = string> extends BaseComponentProps, SizeProps {
    options: Array<{ value: T; label: string; disabled?: boolean }>;
    value?: T;
    defaultValue?: T;
    placeholder?: string;
    disabled?: boolean;
    required?: boolean;
    error?: boolean;
    helperText?: string;
    onChange?: (value: T) => void;
  }
  
  // 布局组件
  export interface GridProps extends BaseComponentProps {
    container?: boolean;
    item?: boolean;
    xs?: number;
    sm?: number;
    md?: number;
    lg?: number;
    xl?: number;
    spacing?: number;
    direction?: 'row' | 'column';
    justify?: 'flex-start' | 'center' | 'flex-end' | 'space-between' | 'space-around';
    align?: 'flex-start' | 'center' | 'flex-end' | 'stretch';
  }
}

// src/ui/forms.ts - 表单相关类型
export namespace Forms {
  export interface FieldState<T> {
    value: T;
    touched: boolean;
    error?: string;
  }
  
  export interface FormState<T extends Record<string, any>> {
    fields: {
      [K in keyof T]: FieldState<T[K]>;
    };
    isSubmitting: boolean;
    isValid: boolean;
    isDirty: boolean;
  }
  
  export interface FieldValidation<T> {
    validate: (value: T) => string | undefined;
    trigger?: 'change' | 'blur' | 'submit';
  }
  
  export interface FormValidation<T extends Record<string, any>> {
    [K in keyof T]?: FieldValidation<T[K]> | FieldValidation<T[K]>[];
  }
  
  export interface FormSubmitEvent<T> {
    data: T;
    reset: () => void;
    setFieldError: (field: keyof T, error: string) => void;
  }
}
```

### 5.5 包配置和构建

```json
// package.json
{
  "name": "@company/types",
  "version": "1.0.0",
  "description": "Shared TypeScript types for company projects",
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "files": [
    "dist/**/*"
  ],
  "scripts": {
    "build": "tsc",
    "build:watch": "tsc --watch",
    "clean": "rm -rf dist",
    "prepublishOnly": "npm run clean && npm run build",
    "test": "jest",
    "lint": "eslint src --ext .ts",
    "type-check": "tsc --noEmit"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "typescript": "^5.0.0",
    "jest": "^29.0.0",
    "@types/jest": "^29.0.0",
    "eslint": "^8.0.0",
    "@typescript-eslint/eslint-plugin": "^5.0.0",
    "@typescript-eslint/parser": "^5.0.0"
  },
  "publishConfig": {
    "access": "public",
    "registry": "https://registry.npmjs.org/"
  },
  "repository": {
    "type": "git",
    "url": "https://github.com/company/types.git"
  },
  "keywords": [
    "typescript",
    "types",
    "shared",
    "company"
  ],
  "author": "Company Team",
  "license": "MIT"
}
```

```json
// tsconfig.json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "moduleResolution": "node",
    "declaration": true,
    "declarationMap": true,
    "sourceMap": true,
    "outDir": "./dist",
    "rootDir": "./src",
    "strict": true,
    "noImplicitAny": true,
    "noImplicitReturns": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "exactOptionalPropertyTypes": true,
    "noImplicitOverride": true,
    "skipLibCheck": true,
    "forceConsistentCasingInFileNames": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "resolveJsonModule": true
  },
  "include": [
    "src/**/*"
  ],
  "exclude": [
    "node_modules",
    "dist",
    "**/*.test.ts"
  ]
}
```

## 6. 练习与作业

### 6.1 基础练习

1. **模块导出练习**
   ```typescript
   // 创建一个工具模块：
   // 1. 导出多个工具函数
   // 2. 创建桶文件
   // 3. 练习重命名导出
   ```

2. **类型声明练习**
   ```typescript
   // 为以下场景创建类型声明：
   // 1. 未类型化的第三方库
   // 2. 全局变量扩展
   // 3. 模块声明
   ```

### 6.2 进阶练习

3. **模块解析练习**
   ```typescript
   // 配置 tsconfig.json：
   // 1. 设置路径别名
   // 2. 配置 typeRoots
   // 3. 设置模块解析策略
   ```

### 6.3 实战作业

4. **完整的类型包**
   - 创建一个可发布的 TypeScript 类型包
   - 包含 API、UI、领域等类型定义
   - 设置构建和发布流程
   - 编写使用文档和示例
   - 添加单元测试

## 7. 最佳实践

### 7.1 模块组织原则

```typescript
// ✅ 按功能模块组织
src/
├── components/     // UI 组件
├── services/      // 业务服务
├── utils/         // 工具函数
├── types/         // 类型定义
└── constants/     // 常量定义

// ✅ 使用桶文件简化导入
// components/index.ts
export { Button } from './Button';
export { Input } from './Input';
export { Select } from './Select';

// 使用：import { Button, Input, Select } from '@/components';

// ❌ 避免深度嵌套的相对路径
// import Button from '../../../../../components/Button/Button';
```

### 7.2 类型定义原则

```typescript
// ✅ 优先使用接口定义对象结构
interface User {
  id: string;
  name: string;
}

// ✅ 使用类型定义联合类型、工具类型
type Status = 'pending' | 'success' | 'error';
type PartialUser = Partial<User>;

// ✅ 合理使用命名空间
namespace Api {
  export interface Response<T> { data: T; }
  export namespace User {
    export interface Create { name: string; }
  }
}

// ❌ 避免过度使用命名空间
// namespace App.UI.Components.Forms.Validation { ... }
```

### 7.3 发布和维护

```typescript
// ✅ 语义化版本控制
// 1.0.0 - 主要版本（不兼容的 API 变更）
// 1.1.0 - 次要版本（向后兼容的功能新增）
// 1.1.1 - 修订版本（向后兼容的问题修正）

// ✅ 明确的 API 契约
export const API_VERSION = '1.0.0' as const;

// ✅ 变更日志
// CHANGELOG.md
// ## [1.1.0] - 2024-01-15
// ### Added
// - New validation types
// - Enhanced error types
// ### Changed
// - Updated User interface with new fields
```

## 8. 课程总结

### 8.1 核心知识点回顾

1. **ES 模块系统**：导入导出语法和作用域
2. **模块解析**：路径映射和解析策略
3. **类型声明**：全局声明、模块声明和命名空间
4. **类型包实践**：构建和发布流程

### 8.2 关键概念

- **模块作用域**：私有和公共成员的区分
- **路径映射**：简化导入路径的配置
- **声明合并**：扩展现有类型定义
- **版本控制**：类型包的版本管理

### 8.3 下节预告

下一课时将学习类型守卫与控制流，包括：
- 类型谓词和类型守卫函数
- 可辨识联合类型
- 控制流分析和类型收窄
- 实现表单状态机类型守卫

### 8.4 扩展阅读

- [TypeScript Handbook - Modules](https://www.typescriptlang.org/docs/handbook/modules.html)
- [TypeScript Handbook - Declaration Files](https://www.typescriptlang.org/docs/handbook/declaration-files/dts-from-js.html)
- [TypeScript Module Resolution](https://www.typescriptlang.org/docs/handbook/module-resolution.html)